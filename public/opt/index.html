<!DOCTYPE html>
<meta charset="utf8" />
<title>Backcountry (opt)</title>
<style>
    html,
    body {
        overflow: hidden;
        margin: 0;
    }
    main {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        pointer-events: none;
    }
    button {
        pointer-events: auto;
        background: none;
        border: none;
        cursor: pointer;
        font: inherit;
        color: inherit;
    }
</style>
<canvas></canvas>
<main></main>
<script src="game.min.js"></script>
<script>
    'use strict';(function(Ca){function va(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a}function ca(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a}function Da(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a}function V(a,b){var c=b[0],d=b[1],e=b[2];c=c*c+d*d+e*e;return 0<c&&(c=1/Ea(c)),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a}function wa(a,b,c){let d=b[0],e=b[1];b=b[2];let f=c[0],g=c[1];c=c[2];return a[0]=e*c-b*g,a[1]=b*f-d*c,a[2]=d*g-e*f,a}function M(a,b,c){var d=b[0],e=
b[1];b=b[2];var f=c[3]*d+c[7]*e+c[11]*b+c[15];return f=f||1,a[0]=(c[0]*d+c[4]*e+c[8]*b+c[12])/f,a[1]=(c[1]*d+c[5]*e+c[9]*b+c[13])/f,a[2]=(c[2]*d+c[6]*e+c[10]*b+c[14])/f,a}function da(a,b,c,d){let e=b[0],f=b[1];b=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=b+d*(c[2]-b),a}function N(){let a=new Float32Array(16);return a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function ea(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],k=b[5],l=b[6],n=b[7],h=b[8],m=b[9],q=b[10],r=b[11],u=b[12],p=b[13],w=b[14];b=b[15];var v=
c*k-d*g,x=c*l-e*g,t=c*n-f*g,z=d*l-e*k,y=d*n-f*k,H=e*n-f*l,I=h*p-m*u,J=h*w-q*u,K=h*b-r*u,X=m*w-q*p,Y=m*b-r*p,Z=q*b-r*w,C=v*Z-x*Y+t*X+z*K-y*J+H*I;return C?(C=1/C,a[0]=(k*Z-l*Y+n*X)*C,a[1]=(e*Y-d*Z-f*X)*C,a[2]=(p*H-w*y+b*z)*C,a[3]=(q*y-m*H-r*z)*C,a[4]=(l*K-g*Z-n*J)*C,a[5]=(c*Z-e*K+f*J)*C,a[6]=(w*t-u*H-b*x)*C,a[7]=(h*H-q*t+r*x)*C,a[8]=(g*Y-k*K+n*I)*C,a[9]=(d*K-c*Y-f*I)*C,a[10]=(u*y-p*t+b*v)*C,a[11]=(m*t-h*y-r*v)*C,a[12]=(k*J-g*X-l*I)*C,a[13]=(c*X-d*J+e*I)*C,a[14]=(p*x-u*z-w*v)*C,a[15]=(h*z-m*x+q*v)*C,
a):null}function Fa(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],k=b[4],l=b[5],n=b[6],h=b[7],m=b[8],q=b[9],r=b[10],u=b[11],p=b[12],w=b[13],v=b[14];b=b[15];var x=c[0],t=c[1],z=c[2],y=c[3];return a[0]=x*d+t*k+z*m+y*p,a[1]=x*e+t*l+z*q+y*w,a[2]=x*f+t*n+z*r+y*v,a[3]=x*g+t*h+z*u+y*b,x=c[4],t=c[5],z=c[6],y=c[7],a[4]=x*d+t*k+z*m+y*p,a[5]=x*e+t*l+z*q+y*w,a[6]=x*f+t*n+z*r+y*v,a[7]=x*g+t*h+z*u+y*b,x=c[8],t=c[9],z=c[10],y=c[11],a[8]=x*d+t*k+z*m+y*p,a[9]=x*e+t*l+z*q+y*w,a[10]=x*f+t*n+z*r+y*v,a[11]=x*g+t*h+z*u+y*b,x=
c[12],t=c[13],z=c[14],y=c[15],a[12]=x*d+t*k+z*m+y*p,a[13]=x*e+t*l+z*q+y*w,a[14]=x*f+t*n+z*r+y*v,a[15]=x*g+t*h+z*u+y*b,a}function F(a,b){return a[0]=b[12],a[1]=b[13],a[2]=b[14],a}function eb(a,b,c){return d=>e=>{var f=N();var g=d.canvas.width/d.canvas.height,k,l=Math.tan;l=1/l(a/2);f=(f[0]=l/g,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=l,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,null!=c&&c!==1/0?(k=1/(b-c),f[10]=(c+b)*k,f[14]=2*c*b*k):(f[10]=-1,f[14]=-2*b),f);d.a[e]|=4;d[2][e]={h:e,position:[],
V:f,ba:ea([],f),view:N(),W:N(),ea:!1}}}function Ga(a,b,c){return d=>e=>{{var f=N();var g=d.canvas.width/d.canvas.height*a,k=-a,l=d.canvas.width/d.canvas.height*-a;let n=1/(l-g),h=1/(k-a),m=1/(b-c);f=(f[0]=-2*n,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*h,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*m,f[11]=0,f[12]=(l+g)*n,f[13]=(a+k)*h,f[14]=(c+b)*m,f[15]=1,f)}d.a[e]|=4;d[2][e]={h:e,position:[],V:f,ba:ea([],f),view:N(),W:N(),ea:!0}}}function fb(a,b=.1){return c=>d=>{c.a[d]|=131072;c[17][d]={target:a,Qa:b}}}function fa(a){return b=>
c=>{b.a[c]|=64;b[6][c]={name:a}}}function R(a){return b=>c=>{let d={};for(let e in a){let {i:f,flags:g=7}=a[e],k=f[f.length-1].timestamp;d[e]={i:f.map(l=>({...l})),flags:g,duration:k,time:0}}b.a[c]|=32;b[5][c]={xa:d,current:d.m}}}function D(a,b){let {A:c}=a,d=gb;return e=>f=>{var g=e.g;var k=g.createVertexArray();g=(g.bindVertexArray(k),g.bindBuffer(g.ARRAY_BUFFER,g.createBuffer()),g.bufferData(g.ARRAY_BUFFER,d.Sa,g.STATIC_DRAW),g.enableVertexAttribArray(1),g.vertexAttribPointer(1,3,g.FLOAT,!1,0,
0),g.bindBuffer(g.ARRAY_BUFFER,g.createBuffer()),g.bufferData(g.ARRAY_BUFFER,d.Pa,g.STATIC_DRAW),g.enableVertexAttribArray(2),g.vertexAttribPointer(2,3,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,g.createBuffer()),g.bufferData(g.ARRAY_BUFFER,c,g.STATIC_DRAW),g.enableVertexAttribArray(3),g.vertexAttribPointer(3,4,g.FLOAT,!1,0,0),g.vertexAttribDivisor(3,1),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,g.createBuffer()),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.oa,g.STATIC_DRAW),g.bindVertexArray(null),k);k=e.B[2];
e.a[f]|=2;e[1][f]={kind:2,w:k,ca:g,Ja:d.oa.length,Ka:c.length/4,T:b}}}function Ha(a,b,c){let d=b[0],e=b[1],f=b[2];b=b[3];let g=c[0],k=c[1],l=c[2];c=c[3];return a[0]=d*c+b*g+e*l-f*k,a[1]=e*c+b*k+f*g-d*l,a[2]=f*c+b*l+d*k-e*g,a[3]=b*c-d*g-e*k-f*l,a}function A(a,b,c,d){var e=.5*Math.PI/180;b*=e;c*=e;d*=e;e=S(b);b=ha(b);let f=S(c);c=ha(c);let g=S(d);d=ha(d);return a[0]=e*c*d-b*f*g,a[1]=b*f*d+e*c*g,a[2]=b*c*g-e*f*d,a[3]=b*c*d+e*f*g,a}function Ia(a,b,c,d,e=0){return f=>g=>{f.a[g]|=262144;f[18][g]={pa:a,
frequency:b,size:c,vertical:d,time:e,H:[],O:[],X:0}}}function Ja(a,b){return c=>d=>{c.a[d]|=2;c[1][d]={kind:3,w:c.B[3],buffer:c.g.createBuffer(),wa:a,ka:b}}}function Ka(a){return{rotation:A([],270,0,0),b:[0,-(a.j[5].size[1]/2+a.j[6].size[1]/2),0],c:[D(a.j[5])],children:[{b:[0,1,-2],c:[Ia(.2,.03,5,5),Ja([0,0,0],[1,1,1])]}]}}function hb(a){return{rotation:A([],270,0,0),b:[.5,-(O(a.j[8].size[1]/2)+a.j[6].size[1]/2),0],c:[D(a.j[8])],children:[{b:[0,1,-2],c:[Ia(.2,.03,5,5),Ja([0,0,0],[1,1,1])]}]}}function ib(a){let b=
La.slice();return a.ua&&b.splice(0,3,...a.ua),a.sa&&b.splice(3,3,...a.sa),a.na&&b.splice(6,3,...a.na),a.la&&b.splice(9,3,...a.la),a.va&&b.splice(12,3,...a.va),a.ma&&b.splice(15,3,...a.ma),b}function jb(a,b){let c=Ma[~~(Math.random()*Ma.length)],d=a.j[1].size[1];a=a.j[c].size[1];let e=.8<Math.random();return{b:e?[0,d/2-2,a/2+1]:[0,a/2+d/2,0],rotation:e?A([],90,0,0):[0,1,0,0],c:[f=>D(f.j[c],b)(f)]}}function L(a){let b=ib({ua:Na[~~(Math.random()*Na.length)],sa:Oa[~~(Math.random()*Oa.length)],na:Pa[~~(Math.random()*
Pa.length)],la:Qa[~~(Math.random()*Qa.length)],va:Ra[~~(Math.random()*Ra.length)],ma:Sa[~~(Math.random()*Sa.length)]});var c=[Ka,Ka,hb];let d=.3<Math.random()?{}:c[~~(Math.random()*c.length)](a);c=.5<Math.random()?{}:c[~~(Math.random()*c.length)](a);return{rotation:[0,1,0,0],children:[{c:[e=>D(e.j[1],b)(e),R({m:{i:[{timestamp:0,rotation:A([],0,5,0)},{timestamp:.5,rotation:A([],0,-5,0)}]},move:{i:[{timestamp:0,rotation:A([],0,5,0)},{timestamp:.2,rotation:A([],0,-5,0)}]}})],children:[jb(a,b)]},{b:[1.5,
0,.5],c:[R({m:{i:[{timestamp:0,rotation:A([],5,0,0)},{timestamp:.5,rotation:A([],-5,0,0)}]},move:{i:[{timestamp:0,rotation:A([],60,0,0)},{timestamp:.2,rotation:A([],-30,0,0)}]}})],children:[{b:[0,-1,0],c:[e=>D(e.j[6],b)(e)]},c]},{b:[-1.5,0,.5],c:[R({m:{i:[{timestamp:0,rotation:A([],-5,0,0)},{timestamp:.5,rotation:A([],5,0,0)}]},move:{i:[{timestamp:0,rotation:A([],-30,0,0)},{timestamp:.2,rotation:A([],60,0,0)}]}})],children:[{b:[0,-1,0],c:[e=>D(e.j[6],b)(e)]},d]},{b:[.5,-2,.5],c:[R({m:{i:[{timestamp:0,
rotation:A([],5,0,0)},{timestamp:1,rotation:A([],5,0,0)}]},move:{i:[{timestamp:0,rotation:A([],-45,0,0)},{timestamp:.2,rotation:A([],45,0,0)}]}})],children:[{b:[0,-1.5,0],c:[e=>D(e.j[2],b)(e)]}]},{b:[-.5,-2,.5],c:[R({m:{i:[{timestamp:0,rotation:A([],-5,0,0)},{timestamp:1,rotation:A([],-5,0,0)}]},move:{i:[{timestamp:0,rotation:A([],45,0,0)},{timestamp:.2,rotation:A([],-45,0,0)}]}})],children:[{b:[0,-1.5,0],c:[e=>D(e.j[2],b)(e)]}]}]}}function P(a,b){return c=>d=>{c.a[d]|=16;c[4][d]={Ba:a,m:b,time:0}}}
function E(a=!0,b=[1,1,1]){return c=>d=>{c.a[d]|=512;c[9][d]={h:d,ra:!0,Fa:a,size:b,min:[0,0,0],max:[0,0,0],L:[]}}}function T(a){return b=>c=>{b.a[c]|=524288;b[19][c]={da:a}}}function kb(a,b){return c=>d=>{c.a[d]|=4096;c[12][d]={x:a,y:b}}}function W(a,b,c){for(let d=0;d<a.a.length;d++)if(4096&a.a[d]&&a[12][d].x===b&&a[12][d].y===c)return d;throw`No entity with coords ${b}, ${c}.`;}function Q(a){return b=>c=>{b.a[c]|=2048;b[11][c]={h:c,flags:a}}}function lb(a,b=a,c=.01){let d=[];for(let e=0;e<a;e++)for(let f=
0;f<b;f++)d.push(e-a/2+.5,.5,f-b/2+.5,Math.random()>c?0:1);return{A:Float32Array.from(d),size:[a,1,b]}}function B(a,b,c){let d=xa(b[0]-a[0],b[1]-a[1],b[2]-a[2]),e=[];for(let f=0;f<d;f++)e=e.concat([...da([],a,b,1/d*f),c]);return e}function mb(){let a=3+~~(5*Math.random()),b=B([0,1,0],[0,a+(4>a?1:~~(5*Math.random())),0],0),c=4>a&&.5<Math.random()?a:3+~~(Math.random()*(a-3)),d=c==a&&.5<Math.random()?2:3+~~(3*Math.random());return b.push(...B([O((d-1)/2),c,0],[O((d-1)/2)-d,c,0],0),...B([O((d-1)/2),c,
0],[O((d-1)/2),c+a-~~(Math.random()*a/2),0],0),...B([O((d-1)/2)-d,c,0],[O((d-1)/2)-d,c+a-~~(Math.random()*a/2),0],0)),{c:[D({A:Float32Array.from(b),size:[0,0,0]},nb),T(1)]}}function ob(){let a=pb();return{b:[0,a.size[1]/2+1,0],rotation:A([],0,90*~~(4*Math.random()),0),c:[b=>D(a,qb)(b),T(1)]}}function pb(){let a=~~(3*Math.random())+1,b=[],c=!1;for(let d,e=0;e<a;e++)d=~~(2*Math.random())-1,b.push(e,0,d,0),.3>Math.random()&&!c&&(c=!0,b.push(e,1,d,0));return{A:Float32Array.from(b),size:[1,1,1]}}function rb(a){a=
a.j[0];return{b:[0,~~(a.size[1]/2)-2.1*~~(3*Math.random()),0],rotation:A([],90*~~(4*Math.random()),90*~~(4*Math.random()),90*~~(4*Math.random())),c:[D(a),T(1)]}}function ia(a,b,c=0,d=0,e=sb){let f=lb(8);e={c:[D(f,e),T(1),P({select:tb}),R({m:{i:[{timestamp:0,b:[0,0,0]}]},select:{i:[{timestamp:0,b:[0,0,0]},{timestamp:.1,b:[0,-.5,0]},{timestamp:.2,b:[0,0,0]}],flags:0}})],children:[]};.85<Math.random()&&b&&e.children.push(ob());b||e.children.push(.5<Math.random()?mb():rb(a));a=b?[Q(2),kb(c,d)]:[];return{b:[0,
0,0],rotation:A([],0,90*~~(4*Math.random()),0),c:[E(!1,[8,1,8]),T(9),...a],children:[e]}}function ja(a=0,b=0,c=!0){return d=>e=>{d.a[e]|=32768;d[15][e]={x:a,y:b,ia:c}}}function ya(a){return b=>c=>{b.a[c]|=65536;b[16][c]={max:a,current:a,M:[]}}}function G(a=[1,1,1],b=1){return c=>d=>{c.a[d]|=8;c[3][d]={h:d,color:a,La:b**2}}}function ka(a=3.5,b=.5){return c=>d=>{c.a[d]|=256;c[8][d]={Oa:a,Xa:b,F:[],J:[]}}}function la(){return a=>b=>{a.a[b]|=128;a[7][b]={destination:null,$:[],fa:0,ga:0}}}function ma(a){return b=>
c=>{b.a[c]|=16384;b[14][c]={Ea:a,target:null}}}function ub(a){a.a=[];a.f=[];a.g.clearColor(1,.3,.3,1);for(var b=0;50>b;b++){a.f[b]=[];for(var c=0;50>c;c++)a.f[b][c]=0==b||49==b||0==c||49==c?NaN:1/0}aa(a,[0,49],[0,49]);for(b=0;50>b;b++)for(let d,e=0;50>e;e++)d=a.f[b][e]==1/0||.5<Math.random(),a.f[b][e]=d?1/0:NaN,c=ia(a,d,b,e),a.add({...c,b:[8*(-25+b),c.b[1],8*(-25+e)]});a.add({b:[1,2,-1],c:[G([.5,.5,.5],0),P({qa:za},"music")]});b=a[0][W(a,1,1)].b;a.add({b:[b[0],5,b[2]],c:[fa("player"),ja(1,1),la(),
ka(25,0),E(!0,[4,7,1]),Q(1),ma(1),P({aa:na,Z:oa})],children:[L(a),{b:[0,25,0],c:[G([1,1,1],20)]}]});a.add({b:[184,5,184],c:[E(!0,[4,7,3]),Q(4),ya(3)],children:[L(a)]});a.add(pa)}function aa(a,[b,c],[d,e]){if(c-b>=e-d){if(3<c-b){var f=qa((b+c)/2),g=e-1,k=d+1,l=~~(Math.random()*(g-k+1))+k,n=!1,h=!1;a.f[e][f]==1/0&&(l=g,n=!0);a.f[d][f]==1/0&&(l=k,h=!0);for(var m=d+1;m<e;m++){if(n&&h){if(m==g||m==k)continue}else if(m==l)continue;a.f[m][f]=NaN}aa(a,[b,f],[d,e]);aa(a,[f,c],[d,e])}}else if(3<e-d){f=qa((d+
e)/2);g=c-1;k=b+1;l=~~(Math.random()*(g-k+1))+k;h=n=!1;a.f[f][c]==1/0&&(l=g,n=!0);a.f[f][b]==1/0&&(l=k,h=!0);for(m=b+1;m<c;m++){if(n&&h){if(m==g||m==k)continue}else if(m==l)continue;a.f[f][m]=NaN}aa(a,[b,c],[d,f]);aa(a,[b,c],[f,e])}}function Aa(a,...b){return c=>d=>{c.a[d]|=1024;c[10][d]={action:a,ya:b}}}function vb(a){var b=Math.floor;a.a=[];a.f=[];a.g.clearColor(1,.3,.3,1);for(var c=0;5>c;c++){a.f[c]=[];for(let d,e=0;5>e;e++){d=.04<Math.random();a.f[c][e]=d?1/0:NaN;let f=ia(a,d,c,e);a.add({...f,
b:[8*(-2.5+c),0,8*(-2.5+e)]})}}a.add({b:[5,5,5],c:[E(!1,[8,8,8]),Aa(0,"map")]});a.add({b:[1,2,-1],c:[G([.5,.5,.5],0)]});c=a[0][W(a,b(2.5),b(2.5))].b;a.add({b:[c[0],5,c[2]],c:[fa("player"),ja(b(2.5),b(2.5)),la(),ka(25,0),E(!0,[4,7,1]),Q(1),ma(1),P({aa:na,Z:oa})],children:[L(a),{b:[0,25,0],c:[G([1,1,1],20)]}]});a.add(pa);a.add({b:[-5,5,5],c:[E(!0,[8,8,8]),Aa(0,"wanted")],children:[L(a)]})}function Ta(a){a.a=[];a.g.clearColor(.95,.73,.35,1);a.add({c:[],children:[L(a)]});a.add({b:[-5,0,15],rotation:A([],
0,-45,0),c:[eb(1,1,100)]});a.add({b:[-15,15,15],children:[{c:[G([1,1,1],25)]}]})}function wb(a,b,c,d,e,f){let g=(8*b-d)/2,k=[...B([4,c,4*-b],[4,c,4*-b+g],1),...B([4,c,4*-b+g+d],[4,c,4*b],1)];if(k.push(...B([4,0,4*-b+g],[4,20,4*-b+g],1),...B([4,0,4*-b+g+d],[4,20,4*-b+g+d],1),...B([4,20,4*-b+g],[4,20,4*-b+g+d+1],1)),f)for(f=0;f<d/8;f++)a.f[e][g/8+f]=1/0;else k.push(...B([4,c,4*-b+g],[4,c,4*-b+g+d],1));for(a=8*-(b/2);a<b/2*8;a+=6)(a<4*-b+g||a>4*-b+g+d)&&k.push(...B([4,0,a],[4,c+2,a],1));return{b:[8*
(-(b/2)+e)-4,0,-3],c:[D({A:Float32Array.from(k),size:[1,1,1]},Ua)]}}function xb(a){a.a=[];a.f=[];a.g.clearColor(1,.3,.3,1);for(var b=0;40>b;b++){a.f[b]=[];for(var c=0;40>c;c++){var d=30===b,e=!!d||!!(.04<Math.random());a.f[b][c]=e&&!d?1/0:NaN;d=ia(a,e,b,c);a.add({...d,b:[8*(-20+b),0,8*(-20+c)]})}}a.add(wb(a,40,4,16,30,!0));a.add({b:[1,2,-1],c:[G([.5,.5,.5],0),P({qa:za},"music")]});b=a[0][W(a,20,20)].b;a.add({b:[b[0],5,b[2]],c:[fa("player"),ja(20,20),la(),ka(25,0),E(!0,[4,7,1]),Q(1),ma(1),P({aa:na,
Z:oa})],children:[L(a),{b:[0,25,0],c:[G([1,1,1],20)]}]});a.add(pa);b=0;for(c=0;4>c;c++){d=[...Ua,...Va[~~(Math.random()*Va.length)]];var f=.3<Math.random(),g=.4<Math.random(),k=.4<Math.random(),l=.2<Math.random(),n=.4<Math.random(),h=[20+8*~~(2*Math.random()),30+8*~~(6*Math.random()),15+~~(10*Math.random())];e=[];for(var m=1;m<h[0];m++)e.push(...B([m,0,h[1]-1],[m,h[2],h[1]-1],n?m%2?4:5:m%2?0:1));for(m=1;m<h[1];m++)e.push(...B([h[0],0,m],[h[0],h[2]*(f?1.5:1),m],n?m%2?4:5:m%2?0:1));for(n=-1;n<h[0]+
3+8;n++)e.push(...B([n-1,0,0],[n-1,0,h[1]+2],1));if(g&&f)for(f=O(h[0]/4),g=~~(.4*h[2])+1,n=f;n<h[1]-f-1;n+=3*f){e.push(...B([h[0]+1,h[2],h[1]-n],[h[0]+1,h[2]+g,h[1]-n],1),...B([h[0]+1,h[2],h[1]-n-f],[h[0]+1,h[2]+g,h[1]-n-f],1));for(m=0;m<g;m++)e.push(...B([h[0]+1,h[2]+m,h[1]-n-1],[h[0]+1,h[2]+m,h[1]-n-f-1],0==m||m==g-1?1:3));e.push(...B([h[0]+2,h[2],h[1]-n],[h[0]+2,h[2],h[1]-n-f-1],1))}else{g=5+~~(3*Math.random());n=~~(.75*h[1]+.2*Math.random()*h[1]);m=~~((h[1]-n)/2);for(let q=2;q<n;q++)for(let r=
0;r<g;r++)e.push(h[0]+1,~~(h[2]*(f?1.5:1))+r-~~(g/2),m+q,.3<Math.random()||2==q||q==n-1||0==r||r==g-1?1:2)}for(f=0;8>f;f++)e.push(...B([h[0]+f+1,.75*h[2],1],[h[0]+f+1,.75*h[2],h[1]+1],1));if(k&&e.push(...B([h[0]+8,0,1],[h[0]+8,.75*h[2],1],1),...B([h[0]+8,0,h[1]],[h[0]+8,.75*h[2],h[1]],1)),l){l=~~(.75*h[1])+1;k=~~(.25*h[2]);e.push(...B([h[0]+8,k,1],[h[0]+8,k,l],1));for(f=1;f<l;f+=2)e.push(...B([h[0]+8,0,f],[h[0]+8,k+2,f],1));e.push(...B([h[0],k,1],[h[0]+8,k,1],1));for(l=3;8>l;l+=2)e.push(...B([h[0]+
l,0,1],[h[0]+l,k+2,1],1))}for(k=1;k<h[1];k++)e.push(...B([0,h[2],k],[h[0]+1,h[2],k],1));k=.65*h[2];l=.2*h[1];for(f=0;f<l;f++)e.push(...B([h[0]+1,0,h[1]-f-3],[h[0]+1,k,h[1]-f-3],1));h=[h[0]+3+8+1,h[2],h[1]+2];d={za:{b:[0,1.5,0],c:[D({A:Float32Array.from(e),size:h},d)]},size:h};e=d.size[0]/8;h=d.size[2]/8;for(k=b;k<b+h;k++)for(l=10;l<10+e;l++)a.f[l][k]=NaN;a.f[10+e-1][b+h-1]=a.f[10+e-1][b+h-2]=1/0;a.add({b:[8*(-10+e-1.5),5,8*(-20+b+h-1.5)],c:[E(!1,[8,8,8]),Aa(0,"house")]});a.add({b:[-81.5,0,8*(-20+
b)-3.5],children:[d.za]});b+=d.size[2]/8+~~(2*Math.random())+1}a.add({b:[15,5,-15],c:[E(!0,[4,7,3]),Q(4),ya(3)],children:[L(a)]})}function yb(a=zb){var b=[];for(let c=0;8>c;c++)for(let d=0;8>d;d++)for(let e=0;6>e;e++)b.push(c-4+.5,e-4+.5,d-4+.5,.4<Math.random()?0:1);b={A:Float32Array.from(b),size:[8,6,8]};a={c:[D(b,a),T(1)]};return{b:[0,4,0],c:[E(!1,[8,1,8]),T(9)],children:[a]}}function Ab(a){a.a=[];a.f=[];a.g.clearColor(1,.3,.3,1);for(var b=0;15>b;b++){a.f[b]=[];for(var c=0;15>c;c++)a.f[b][c]=0==
b||14==b||0==c||14==c?NaN:1/0}ba(a,[0,14],[0,14]);b=[.6,.4,0,.55,0,0];for(c=0;15>c;c++)for(let e=0;15>e;e++){var d=a.f[c][e]==1/0;d=d?ia(a,d,c,e,b):yb(b);a.add({...d,b:[8*(-7.5+c),d.b[1],8*(-7.5+e)]})}a.add({b:[1,2,-1],c:[G([.5,.5,.5],0),P({qa:za},"music")]});b=a[0][W(a,1,1)].b;a.add({b:[b[0],5,b[2]],c:[fa("player"),ja(1,1,!1),la(),ka(25,0),E(!0,[4,7,1]),Q(1),ma(1),P({aa:na,Z:oa})],children:[L(a),{b:[0,25,0],c:[G([1,1,1],20)]}]});a.add({b:[44,5,44],c:[E(!0,[4,7,3]),Q(4),ya(3)],children:[L(a)]});a.add(pa)}
function ba(a,[b,c],[d,e]){if(c-b>=e-d){if(3<c-b){var f=qa((b+c)/2),g=e-1,k=d+1,l=~~(Math.random()*(g-k+1))+k,n=!1,h=!1;a.f[e][f]==1/0&&(l=g,n=!0);a.f[d][f]==1/0&&(l=k,h=!0);for(var m=d+1;m<e;m++){if(n&&h){if(m==g||m==k)continue}else if(m==l)continue;a.f[m][f]=NaN}ba(a,[b,f],[d,e]);ba(a,[f,c],[d,e])}}else if(3<e-d){f=qa((d+e)/2);g=c-1;k=b+1;l=~~(Math.random()*(g-k+1))+k;h=n=!1;a.f[f][c]==1/0&&(l=g,n=!0);a.f[f][b]==1/0&&(l=k,h=!0);for(m=b+1;m<c;m++){if(n&&h){if(m==g||m==k)continue}else if(m==l)continue;
a.f[f][m]=NaN}ba(a,[b,c],[d,f]);ba(a,[b,c],[f,e])}}function Bb(a){a.a=[];a.g.clearColor(1,.8,.6,1);a.add({c:[R({m:{i:[{timestamp:0,rotation:[0,0,0,1]},{timestamp:2,rotation:[0,1,0,0]},{timestamp:4,rotation:[0,0,0,-1]}],flags:2}})],children:[L(a)]});a.add({b:[0,2,10],c:[Ga(10,1,100)]});a.add({b:[1,1,1],c:[G([.5,.5,.5],0)]});a.add({b:[-15,15,15],c:[G([1,1,1],25)]})}function Cb(a,b,c){switch(b){case 0:switch(c[0]){case "intro":return setTimeout(Ta,0,a);case "map":return setTimeout(xb,0,a);case "house":return setTimeout(vb,
0,a);case "wanted":return setTimeout(Bb,0,a);case "mine":return setTimeout(Ab,0,a);case "desert":return setTimeout(ub,0,a)}case 1:return void console.log(`Hit entity #${c[0]}`)}}function Db(a=[0,0,0],b=[0,0,0,1],c=[1,1,1]){return d=>e=>{d.a[e]|=1;d[0][e]={h:e,a:N(),self:N(),b:a,rotation:b,scale:c,children:[],o:!0}}}function*U(a,b,c){a.a[b.h]&1<<c&&(yield a[c][b.h]);for(let d of b.children)yield*U(a,d,c)}function ra(a,b,c,d){var e=a.createProgram();if(a.attachShader(e,Wa(a,a.VERTEX_SHADER,c)),a.attachShader(e,
Wa(a,a.FRAGMENT_SHADER,d)),a.linkProgram(e),!a.getProgramParameter(e,a.LINK_STATUS))throw Error(a.getProgramInfoLog(e));c=e;b={g:a,mode:b,U:c,D:{}};c=a.getProgramParameter(b.U,a.ACTIVE_UNIFORMS);for(d=0;d<c;++d)({name:e}=a.getActiveUniform(b.U,d)),b.D[e.replace(/\[0\]$/,"")]=a.getUniformLocation(b.U,e);return b}function Wa(a,b,c){b=a.createShader(b);if(a.shaderSource(b,c),a.compileShader(b),!a.getShaderParameter(b,a.COMPILE_STATUS))throw Error(a.getShaderInfoLog(b));return b}function Eb(a){return ra(a,
a.TRIANGLES,"#version 300 es\n    uniform mat4 pv;\n    uniform mat4 world;\n    uniform mat4 self;\n    uniform vec4 color;\n    uniform int light_count;\n    uniform vec3 light_positions[10];\n    uniform vec4 light_details[10];\n\n    layout(location=1) in vec3 position;\n    layout(location=2) in vec3 normal;\n    out vec4 vert_color;\n\n    void main() {\n        vec4 world_pos = world * vec4(position, 1.0);\n        vec3 world_normal = normalize((vec4(normal, 1.0) * self).xyz);\n        gl_Position = pv * world_pos;\n\n        vec3 rgb = vec3(0.0, 0.0, 0.0);\n        for (int i = 0; i < light_count; i++) {\n            vec3 light_dir = light_positions[i] - world_pos.xyz ;\n            vec3 light_normal = normalize(light_dir);\n            float light_dist = length(light_dir);\n\n            float diffuse_factor = max(dot(world_normal, light_normal), 0.0);\n            float distance_factor = light_dist * light_dist;\n            float intensity_factor = light_details[i].a;\n\n            rgb += color.rgb * light_details[i].rgb * diffuse_factor\n                    * intensity_factor / distance_factor;\n        }\n\n        vert_color = vec4(rgb, 1.0);\n    }\n",
"#version 300 es\n    precision mediump float;\n\n    in vec4 vert_color;\n    out vec4 frag_color;\n\n    void main() {\n        frag_color = vert_color;\n    }\n")}function Fb(a){return ra(a,a.TRIANGLES,"#version 300 es\n    uniform mat4 pv;\n    uniform mat4 world;\n    uniform mat4 self;\n    uniform vec4 color;\n    uniform vec3 palette[16];\n    uniform vec3 camera_pos;\n\n    uniform int light_count;\n    uniform vec3 light_positions[10];\n    uniform vec4 light_details[10];\n\n    layout(location=1) in vec3 position;\n    layout(location=2) in vec3 normal;\n    layout(location=3) in vec4 offset;\n\n    out vec4 vert_color;\n\n    const float fog_dist = 50.0;\n\n    void main() {\n        vec4 world_pos = world * vec4(position + offset.xyz, 1.0);\n        vec3 world_normal = normalize((vec4(normal, 0.0) * self).xyz);\n        gl_Position = pv * world_pos;\n\n        vec3 rgb = palette[int(offset[3])].rgb * 0.1;\n        for (int i = 0; i < light_count; i++) {\n            if (light_details[i].a == 0.0) {\n                // A directional light.\n                vec3 light_normal = normalize(light_positions[i]);\n                float diffuse_factor = max(dot(world_normal, light_normal), 0.0);\n                rgb += palette[int(offset[3])].rgb * light_details[i].rgb * diffuse_factor;\n            } else {\n                // A point light.\n                vec3 light_dir = light_positions[i] - world_pos.xyz ;\n                vec3 light_normal = normalize(light_dir);\n                float light_dist = length(light_dir);\n\n                float diffuse_factor = max(dot(world_normal, light_normal), 0.0);\n                float distance_factor = light_dist * light_dist;\n                float intensity_factor = light_details[i].a;\n\n                rgb += palette[int(offset[3])].rgb * light_details[i].rgb * diffuse_factor\n                        * intensity_factor / distance_factor;\n            }\n        }\n\n        vert_color = vec4(rgb, 1.0);\n    }\n",
"#version 300 es\n    precision mediump float;\n\n    in vec4 vert_color;\n    out vec4 frag_color;\n\n    void main() {\n        frag_color = vert_color;\n    }\n")}function Gb(a){return ra(a,a.POINTS,"#version 300 es\n    uniform mat4 pv;\n    uniform vec3 camera_pos;\n    uniform float size;\n    uniform float vertical;\n    uniform vec3 start_color;\n    uniform vec3 end_color;\n\n    layout(location=1) in float id;\n    layout(location=2) in vec3 origin;\n    layout(location=3) in float age;\n\n    out vec4 vert_color;\n\n    void main() {\n        // Pseudo-random numbers in range of [-0.5, 0.5].\n        float rand_x = id - 0.5;\n        float rand_y = fract(id * 1000.0) - 0.5;\n\n        vec4 world_pos = vec4(origin, 1.0);\n        world_pos.x += rand_x / 3.0;\n        world_pos.y += age * vertical;\n        world_pos.z += rand_y / 3.0;\n        gl_Position = pv * world_pos;\n        gl_PointSize = mix(size, size * 10.0, age);\n        vert_color = mix(vec4(start_color, 1.0), vec4(end_color, 1.0), age);\n    }\n",
"#version 300 es\n    precision mediump float;\n\n    in vec4 vert_color;\n    out vec4 frag_color;\n\n    void main() {\n        frag_color = vert_color;\n    }\n")}function Hb(a){return ra(a,a.LINE_LOOP,"#version 300 es\n    uniform mat4 pv;\n    uniform mat4 world;\n\n    layout(location=1) in vec3 position;\n\n    void main() {\n        gl_Position = pv * world * vec4(position, 1.0);\n    }\n","#version 300 es\n    precision mediump float;\n    uniform vec4 color;\n\n    out vec4 frag_color;\n\n    void main() {\n        frag_color = color;\n    }\n")}
function Ib(a){for(let c=0;c<a.a.length;c++)if(16385===(a.a[c]&16385)){var b=a[14][c];if(b.target){let d=a[8][c];b=M([],b.target,a[0][c].self);b[1]=0;V(b,b);d.J.push(Xa([],[0,0,1],b))}}}function Jb(a,b){for(let l=0;l<a.a.length;l++)if(33===(a.a[l]&33)){{var c=b;let n=a[0][l],h=a[5][l],m=h.l&&h.xa[h.l];m&&1&h.current.flags&&(h.current=m,h.l=void 0);let q=null,r=null;for(let u of h.current.i)if(h.current.time<u.timestamp){r=u;break}else q=u;if(q&&r){let u=(h.current.time-q.timestamp)/(r.timestamp-q.timestamp);
r.Ga&&(u=r.Ga(u));q.b&&r.b&&(da(n.b,q.b,r.b,u),n.o=!0);if(q.rotation&&r.rotation){{let p=void 0,w=void 0,v=void 0;let x=void 0;var d=n.rotation,e=q.rotation;var f=r.rotation;var g=u,k=Math.acos;let t=e[0],z=e[1],y=e[2];e=e[3];let H=f[0],I=f[1],J=f[2],K=f[3];f=t*H+z*I+y*J+e*K;0>f&&(f=-f,H=-H,I=-I,J=-J,K=-K);1E-6<1-f?(x=k(f),v=S(x),w=S((1-g)*x)/v,p=S(g*x)/v):(w=1-g,p=g);d[0]=w*t+p*H;d[1]=w*z+p*I;d[2]=w*y+p*J;d[3]=w*e+p*K}n.o=!0}q.scale&&r.scale&&(da(n.scale,q.scale,r.scale,u),n.o=!0)}c=h.current.time+
c;if(c<h.current.duration)h.current.time=c;else{if(h.current.time=0,4&h.current.flags)for(let u of h.current.i.reverse())u.timestamp=h.current.duration-u.timestamp;m?(h.current=m,h.l=void 0):!(2&h.current.flags)&&(h.current=h.xa.m)}}}}function Kb(a){let b=[],c=[];for(var d=0;d<a.a.length;d++)if(513===(a.a[d]&513)){var e=a[0][d];let f=a[9][d];b.push(f);f.L=[];f.ra?(f.ra=!1,Ya(e,f)):f.Fa&&(Ya(e,f),c.push(f))}for(e=0;e<c.length;e++){a=c[e];d=b;for(let f,g=0;g<d.length;g++)f=d[g],a!==f&&a.min[0]<f.max[0]&&
a.max[0]>f.min[0]&&a.min[1]<f.max[1]&&a.max[1]>f.min[1]&&a.min[2]<f.max[2]&&a.max[2]>f.min[2]&&(a.L.push(f),f.L.push(a))}}function Ya(a,b){a=F([],a.a);let c=Da([],b.size,.5);ca(b.min,a,c);va(b.max,a,c)}function Lb(a){if(a.s[0].ea)for(let f=0;f<a.a.length;f++)if(524289===(a.a[f]&524289)){{var b=a,c=f,d=Math.abs;let g=b[19][c];var e=F([],b[0][c].a);e=M([],e,b.s[0].view);d(e[0])>1/b.s[0].V[0]+8||d(e[1])>1/b.s[0].V[5]+8?b.a[c]&=~(1<<g.da):b.a[c]|=1<<g.da}}}function Mb(a){for(let d=0;d<a.a.length;d++)if(65536===
(a.a[d]&65536)){{var b=a,c=d;let e=b[16][c];for(let f=0;f<e.M.length;f++)e.current-=e.M[f],0>=e.current&&(console.log(`Entity #${c} has died.`),b.ha(c));e.M=[]}}}function Nb(a){for(let b=0;b<a.a.length;b++)if(131073===(a.a[b]&131073)){let c=a[0][b],d=a[17][b],e=F([],a[0][d.target].a);c.b=da([],c.b,e,d.Qa);c.o=!0}}function Ob(a,b){for(let g=0;g<a.a.length;g++)if(257===(a.a[g]&257)){{var c=a,d=b;let k=c[0][g],l=c[8][g];for(let n of U(c,k,5))n.l||(n.l=l.F.length?"move":"idle");if(l.F.length){var e=l.F.reduce(Pb);
c=F([],k.a);var f=k.a;e=M([],e,f);f=F([],f);f=ca([],e,f);V(f,f);Da(f,f,l.Oa*d);d=va([],c,f);k.parent&&M(d,d,k.parent.self);k.b=d;k.o=!0;l.F.length=0}l.J.length&&(d=l.J.reduce(Qb),Ha(k.rotation,d,k.rotation),k.o=!0,l.J.length=0)}}}function Pb(a,b){return va(a,a,b)}function Qb(a,b){return Ha(a,a,b)}function Rb(a){for(let g=0;g<a.a.length;g++)if(385===(a.a[g]&385)){{var b=a,c=g;let k=b[7][c],l=b[15][c];if(!k.destination&&k.$.length){var d=k.$.pop(),e=W(b,d[0],d[1]);k.fa=d[0];k.ga=d[1];k.destination=
b[0][e].b}if(k.destination){var f=b[0][c];d=F([],f.a);e=[k.destination[0],d[1],k.destination[2]];f=M([],e,f.self);V(f,f);b=b[8][c];b.F.push(f);b.J.push(Xa([],[0,0,1],f));b=ca([],e,d);1>xa(b[0],b[1],b[2])&&(l.x=k.fa,l.y=k.ga,k.destination=null)}}}}function Sb(a,b){for(let d=0;d<a.a.length;d++)if(262145===(a.a[d]&262145)){{var c=b;let e=a[18][d],f=a[0][d];if(e.X+=c,0<e.time&&e.X>e.frequency){e.time-=c;e.X=0;let g={id:Math.random(),origin:[0,0,0],K:0};F(g.origin,f.a);e.H.push(g)}e.O=[];for(let g,k=0;k<
e.H.length;)g=e.H[k],g.K+=c,g.K>e.pa?e.H.shift():(e.O.push(g.id,...g.origin,g.K/e.pa),k++)}}}function Za(a,b,c){c&&(c.textContent=`${b.toFixed(1)} ms`)}function Tb(a){var b=a.s[0];if(8192&a.a[b.h]){let h=a[13][b.h];for(let m=0;m<a.a.length;m++)if(49153===(a.a[m]&49153)){b=a;var c=m,d=h;if(d.u){if(b.event.Ma){if(2&d.u.v.flags){{var e;var f=b;var g=b[12][d.u.v.h],k=Number.isNaN;let q=f[15][c];for(e=0;e<f.f.length;e++)for(var l=0;l<f.f[0].length;l++)k(f.f[e][l])||(f.f[e][l]=1/0);f.f[q.x][q.y]=0;k=q.ia;
for(l=[{x:q.x,y:q.y}];e=l.shift();)if(15>f.f[e.x][e.y])for(var n of $a(f,e.x,e.y,k))f.f[n.x][n.y]>f.f[e.x][e.y]+1&&(f.f[n.x][n.y]=f.f[e.x][e.y]+1,l.push(n));if(f.f[g.x][g.y]<1/0){for(k=[];g.x!==q.x||g.y!==q.y;){k.push([g.x,g.y]);e=$a(f,g.x,g.y,q.ia);for(let r,u=0;u<e.length;u++)r=e[u],f.f[r.x][r.y]<f.f[g.x][g.y]&&(g=f[12][W(f,r.x,r.y)])}f=k}else f=!1}f&&(b[7][c].$=f)}4&d.u.v.flags&&(b[14][c].target=F([],b[0][d.u.v.h].a))}b.event.Na&&(b[14][c].target=d.u.Ca)}}if(h.u&&(a.event.Ma||a.event.Na)){n=a[0][h.u.v.h];
for(let m of U(a,n,5))m.l="select";for(let m of U(a,n,4))m.l="select"}}}function $a(a,b,c,d){let e=[{x:b-1,y:c},{x:b+1,y:c},{x:b,y:c-1},{x:b,y:c+1}];return d&&e.push({x:b-1,y:c-1},{x:b+1,y:c-1},{x:b-1,y:c+1},{x:b+1,y:c+1}),e.filter(({x:f,y:g})=>0<=f&&f<a.f.length&&0<=g&&g<a.f[0].length)}function ab(a,b,c){let d=1/0,e=null;for(let l,n=0;n<a.I.length;n++)if(l=a[9][a.I[n].h],!(b[0]>=l.min[0]&&b[0]<=l.max[0]&&b[1]>=l.min[1]&&b[1]<=l.max[1]&&b[2]>=l.min[2]&&b[2]<=l.max[2])){a:{var f=b;var g=c,k=l;let h=
-Infinity,m=Infinity;for(let q=0;3>q;q++){let r=(k.min[q]-f[q])/g[q],u=(k.max[q]-f[q])/g[q];if(r>u&&([r,u]=[u,r]),u<h||r>m){f=1/0;break a}r>h&&(h=r);u<m&&(m=u)}f=h>m?1/0:h}f<d&&(d=f,e=n)}if(null!==e)return{v:a.I[e],Ca:[b[0]+c[0]*d,b[1]+c[1]*d,b[2]+c[2]*d]}}function Ub(a){a.I=[];for(var b=0;b<a.a.length;b++)2561===(a.a[b]&2561)&&a.I.push(a[11][b]);for(let e=0;e<a.a.length;e++)if(8197===(a.a[e]&8197)){{b=a;let f=b[0][e],g=b[2][e],k=b[13][e];var c=b.input.R/b.canvas.width*2-1,d=2*-(b.input.S/b.canvas.height)+
1;let l=[c,d,-1];c=[c,d,1];d=[0,0,0];M(l,l,g.ba);M(l,l,f.a);M(c,c,g.ba);M(c,c,f.a);ca(d,c,l);V(d,d);k.u=ab(b,l,d)}}}function Vb(a){for(let g=0;g<a.a.length;g++)if(16385===(a.a[g]&16385)){{var b=a,c=g;let k=b[14][c];if(k.target){console.log(`Shot fired at ${k.target}`);c=b[0][c];var d=F([],c.a);var e=[];var f=c.a;e=(e[0]=f[8],e[1]=f[9],e[2]=f[10],V(e,e));if((d=ab(b,d,e))&&4&d.v.flags){b[16][d.v.h].M.push(k.Ea);b.ja(1,d.v.h);for(let l of U(b,c,4))l.l="shoot"}else for(let l of U(b,c,4))l.l="miss";for(let l of U(b,
c,18))l.time=.2}k.target=null}}}function Wb(a){for(let w=0;w<a.a.length;w++)if(1===(a.a[w]&1)){var b=a[0][w];if(b.o){b.o=!1;bb(b);var c=b.a,d=b.rotation,e=b.b,f=b.scale,g=d[0],k=d[1],l=d[2],n=d[3],h=g+g,m=k+k,q=l+l;d=g*h;var r=g*m;g*=q;var u=k*m;k*=q;l*=q;h*=n;m*=n;n*=q;q=f[0];var p=f[1];f=f[2];c[0]=(1-(u+l))*q;c[1]=(r+n)*q;c[2]=(g-m)*q;c[3]=0;c[4]=(r-n)*p;c[5]=(1-(d+l))*p;c[6]=(k+h)*p;c[7]=0;c[8]=(g+m)*f;c[9]=(k-h)*f;c[10]=(1-(d+u))*f;c[11]=0;c[12]=e[0];c[13]=e[1];c[14]=e[2];c[15]=1;b.parent&&Fa(b.a,
b.parent.a,b.a);ea(b.self,b.a)}}}function bb(a){for(let b of a.children)b.o=!0,bb(b)}function Xb(a){for(let b=0;b<a.a.length;b++)if(1537===(a.a[b]&1537)&&0<a[9][b].L.length){let c=a[10][b];a.ja(c.action,...c.ya,b)}}function sa(a,...b){return a.reduce((c,d)=>{var e=b.shift();e=!1===e||void 0===e?"":Array.isArray(e)?e.join(""):e;return c+e+d})}function Ba(){return sa`
        ${"intro map wanted house desert mine".split(" ").map(a=>sa`
                    <button
                        onclick="game.dispatch(${0}, '${a}')"
                        style="color: #fff"
                    >
                        ${a}
                    </button>
                `)}
    `}async function Yb(a){a=await (await fetch(a)).arrayBuffer();a=new Uint16Array(a);let b=[],c=0;for(;c<a.length;){let d=c+1,e=a[c],f=[];for(c=d;c<d+e+1;c++){let k=a[c];f.push((15&k)>>0,(240&k)>>4,(3840&k)>>8,(61440&k)>>12)}let g=f.splice(0,3).map(k=>++k);f.shift();b.push({A:(new Float32Array(f)).map((k,l)=>{switch(l%4){case 0:return k-g[0]/2+.5;case 1:return k-g[1]/2+.5;case 2:return k-g[2]/2+.5;default:return k}}),size:g})}return b}var qa=Math.ceil,O=Math.round,ha=Math.cos,S=Math.sin,xa=Math.hypot,
Ea=Math.sqrt;let pa={b:[0,20,0],c:[a=>{var b;a:{for(b=0;b<a.a.length;b++)if(64&a.a[b]&&"player"===a[6][b].name)break a;throw"No entity named player.";}return fb(b)(a)}],children:[{b:[25,25,25],rotation:[-.28,.364,.116,.88],c:[Ga(25,1,100),function(){return a=>b=>{a.a[b]|=8192;a[13][b]={}}}()]}]};const gb={Sa:Float32Array.from([-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,
-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5]),oa:Uint16Array.from([23,22,20,22,21,20,19,18,16,18,17,16,15,14,12,14,13,12,11,10,8,10,9,8,7,6,4,6,5,4,3,2,0,2,1,0]),Pa:Float32Array.from([-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0])},Xa=function(){let a=[],b=[1,0,0],c=[0,1,0];return function(d,e,f){var g=e[0]*f[0]+e[1]*f[1]+e[2]*f[2];if(-.999999>g)wa(a,b,
e),1E-6>xa(a[0],a[1],a[2])&&wa(a,c,e),V(a,a),e=Math.PI,e*=.5,f=S(e),d[0]=f*a[0],d[1]=f*a[1],d[2]=f*a[2],d[3]=ha(e);else if(.999999<g)d=(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d);else{wa(a,e,f);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+g;{f=d[0];g=d[1];let k=d[2],l=d[3];e=f*f+g*g+k*k+l*l;d=(0<e&&(e=1/Ea(e)),d[0]=f*e,d[1]=g*e,d[2]=k*e,d[3]=l*e,d)}}return d}}();let La=[1,1,1,1,1,1,1,1,.8,1,1,.6,1,1,.4,1,1,.2,1,1,0,.53,0,0,.47,.47,.47],Ma=[3,4,7,9,10,11,12],Na=[[1,0,0],[0,1,0],[0,0,1],[1,1,1]],Pa=[[.2,.2,.2],[.9,.9,
.9],[.53,0,0],[1,0,0]],Qa=[[0,0,0],[1,1,1],[1,1,0],[.9,0,0]],Ra=[[1,.8,.6],[1,.8,.6],[.6,.4,0]],Sa=[[1,1,0],[0,0,0],[.6,.4,0],[.4,0,0]],Oa=[[0,0,0],[.53,0,0],[.53,0,0],[.6,.4,.2],[.33,.33,.33]],tb={Y:[{P:[7,!0,"lowpass",8,8,!1,!1,"sine",8,8,[[0,4,1,0,3,"sine",8,!1,!1,7,7,7]]],C:[69]}],N:.2},nb=[0,.8,0],qb=[.6,.4,0],sb=[1,.8,.4,.6,.4,0],oa={Y:[{P:[11,!0,"lowpass",12,5,!1,!1,"sine",13,4,[[1,10,0,0,5],[0,7,1,1,5,"triangle",8,!1,!0,2,3,11]]],C:[57]}],N:.2},za={Aa:110,Y:[{P:[7,!0,"bandpass",10,3,!1,!1,
"sine",8,8,[[0,7,2,2,8,"triangle",8,!1,!1,7,7,7]]],C:[69,74,69,74,69,,,,,,,,65,,,,67,,,,62,,,,,,,,69,74,69,74,69,,,,,,,,65,,,,67,,,,72,,,,,,,,69,74,69,74,,,,,,,,,65,,,,64,,62,,60,,,,,,,,69,74,69,74,69,,,,67,,,,62,,62]}],N:20},na={Y:[{P:[13,!0,"lowpass",10,4,!1,!1,"sine",13,1,[[1,10,0,0,5],[0,7,0,2,2,"sine",8,!1,!1,8,8,8]]],C:[57]}],N:.2},Ua=[.6,.4,0,.4,.2,0,.14,0,0,.2,.8,1],Va=[[.87,.87,.87,.73,.73,.73],[0,.47,0,0,.33,0],[.67,0,0,.54,0,0]],zb=[1,.8,.4,.6,.4,0],ta,cb=document.getElementById("fps"),
db;const Zb={a:"intro"};let ua=new class{constructor(){this.f=[];this[0]=[];this[1]=[];this[2]=[];this[3]=[];this[4]=[];this[5]=[];this[6]=[];this[8]=[];this[7]=[];this[9]=[];this[10]=[];this[11]=[];this[12]=[];this[13]=[];this[14]=[];this[15]=[];this[16]=[];this[17]=[];this[18]=[];this[19]=[];this.audio=new AudioContext;this.Ra=document.querySelector("main");this.input={R:0,S:0};this.event={R:0,S:0,Ya:0};this.state=Zb;this.ja=(a,...b)=>{var c=this.state;this.state=0===a?{...c,a:b[0]}:c;Cb(this,a,
b)};this.B=[];this.s=[];this.G=[];this.j=[];this.T=La;this.I=[];this.ta=0;this.a=[];document.addEventListener("visibilitychange",()=>document.hidden?this.stop():this.start());this.canvas=document.querySelector("canvas");this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;window.addEventListener("keydown",a=>this.input[a.code]=1);window.addEventListener("keyup",a=>this.input[a.code]=0);this.canvas.addEventListener("contextmenu",a=>a.preventDefault());this.canvas.addEventListener("mousedown",
a=>{this.input[`mouse_${a.button}`]=1;this.event[`mouse_${a.button}_down`]=1});this.canvas.addEventListener("mouseup",a=>{this.input[`mouse_${a.button}`]=0;this.event[`mouse_${a.button}_up`]=1});this.canvas.addEventListener("mousemove",a=>{this.input.R=a.offsetX;this.input.S=a.offsetY;this.event.R=a.movementX;this.event.S=a.movementY});this.g=this.canvas.getContext("webgl2");this.g.enable(this.g.DEPTH_TEST);this.g.enable(this.g.CULL_FACE);this.g.frontFace(this.g.CW);this.B[0]=Hb(this.g);this.B[1]=
Eb(this.g);this.B[2]=Fb(this.g);this.B[3]=Gb(this.g)}Da(){for(let a=0;1E4>a;a++)if(!this.a[a])return this.a[a]=0,a;throw Error("No more entities available.");}Ha(a){let b=performance.now();for(let c in Ub(this),Tb(this),Ib(this),Rb(this),Jb(this,a),Sb(this,a),Ob(this,a),Wb(this),Kb(this),Xb(this),Vb(this),Mb(this),Nb(this),Lb(this),Za(this,performance.now()-b,document.querySelector("#fixed")),this.event)this.event[c]=0}Ia(a){let b=performance.now();for(var c=0;c<this.a.length;c++)if(16===(this.a[c]&
16)){var d=a,e=this[4][c],f=e.l&&e.Ba[e.l],g=!e.current||e.time>e.current.N;if(f&&g){let p=60/(f.Aa||120);for(var k of f.Y)for(let w=0;w<k.C.length;w++)if(k.C[w]){{let v=void 0,x=void 0;d=this.audio;var l=k.P;g=k.C[w];let t=d.currentTime+p/4*w,z=0,y=d.createGain();y.gain.value=(l[0]/9)**3;if(l[6]&&(v=d.createOscillator(),v.type=l[7],v.frequency.value=(l[9]/3)**3,x=d.createGain(),x.gain.value=(l[8]+3)**3,v.connect(x)),l[1]){var n=d.createBiquadFilter();n.type=l[2];n.frequency.value=2**l[3];n.Q.value=
l[4]**1.5;x&&l[5]&&x.connect(n.detune);y.connect(n);n.connect(d.destination)}else y.connect(d.destination);for(var h of l[10]){n=d.createGain();n.connect(y);var m=(h[1]/9)**3,q=(h[2]/9)**3,r=(h[3]/9)**3;l=q+r+(h[4]/6)**3;if(n.gain.setValueAtTime(0,t),n.gain.linearRampToValueAtTime(m,t+q),n.gain.setValueAtTime(m,t+q+r),n.gain.exponentialRampToValueAtTime(1E-5,t+l),0===h[0]){m=d.createOscillator();m.type=h[5];m.connect(n);m.detune.value=3*(h[6]-7.5)**3;x&&h[7]&&x.connect(m.detune);n=440*2**((g-69)/
12);q=(h[9]/9)**3;r=(h[10]/9)**3;var u=(h[11]/6)**3;h[8]?(m.frequency.linearRampToValueAtTime(0,t),m.frequency.linearRampToValueAtTime(n,t+q),m.frequency.setValueAtTime(n,t+q+r),m.frequency.exponentialRampToValueAtTime(1E-5,t+q+r+u)):m.frequency.setValueAtTime(n,t);m.start(t);m.stop(t+l)}else{m=r=d.createBufferSource();if(!ta)for(ta=d.createBuffer(1,2*d.sampleRate,d.sampleRate),u=ta.getChannelData(0),q=0;q<u.length;q++)u[q]=2*Math.random()-1;m.buffer=ta;r.loop=!0;r.connect(n);r.start(t);r.stop(t+
l)}l>z&&(z=l)}v&&(v.start(t),v.stop(t+z))}}e.current=f;e.time=0}else e.time+=d;e.l=e.m}this.s=[];for(c=0;c<this.a.length;c++)5===(this.a[c]&5)&&(e=this[0][c],f=this[2][c],this.s.push(f),F(f.position,e.a),ea(f.view,e.a),Fa(f.W,f.V,f.view));this.G=[];for(c=0;c<this.a.length;c++)9===(this.a[c]&9)&&this.G.push(this[3][c]);this.g.clear(this.g.COLOR_BUFFER_BIT|this.g.DEPTH_BUFFER_BIT);c=[];e=[];for(f=0;f<this.G.length;f++)k=this.G[f],h=F([],this[0][k.h].a),c.push(...h),e.push(...k.color,k.La);f=null;for(k=
0;k<this.a.length;k++)if(3===(this.a[k]&3)){d=this[0][k];h=this[1][k];if(h.w!==f){f=h.w;let {g:p,U:w,D:v}=f;switch(p.useProgram(w),p.uniformMatrix4fv(v.W,!1,this.s[0].W),h.kind){case 1:case 2:p.uniform1i(v.Ua,this.G.length),p.uniform3fv(v.Wa,c),p.uniform4fv(v.Va,e)}}switch(h.kind){case 0:{let {g:p,mode:w,D:v}=h.w;p.uniformMatrix4fv(v.a,!1,d.a);p.uniform4fv(v.color,h.color);p.bindVertexArray(h.ca);p.drawElements(w,h.count,p.UNSIGNED_SHORT,0);p.bindVertexArray(null)}break;case 1:{let {g:p,mode:w,D:v}=
h.w;p.uniformMatrix4fv(v.a,!1,d.a);p.uniformMatrix4fv(v.self,!1,d.self);p.uniform4fv(v.color,h.color);p.bindVertexArray(h.ca);p.drawElements(w,h.count,p.UNSIGNED_SHORT,0);p.bindVertexArray(null)}break;case 2:{let {g:p,mode:w,D:v}=h.w;p.uniformMatrix4fv(v.a,!1,d.a);p.uniformMatrix4fv(v.self,!1,d.self);p.uniform3fv(v.T,h.T||this.T);p.bindVertexArray(h.ca);p.drawElementsInstanced(w,h.Ja,p.UNSIGNED_SHORT,0,h.Ka);p.bindVertexArray(null)}break;case 3:if(d=this[18][k],d.O.length){{let {g:p,mode:w,D:v}=h.w;
p.uniform1f(v.size,d.size);p.uniform1f(v.vertical,d.vertical);p.uniform3fv(v.wa,h.wa);p.uniform3fv(v.ka,h.ka);p.bindBuffer(p.ARRAY_BUFFER,h.buffer);p.bufferData(p.ARRAY_BUFFER,Float32Array.from(d.O),p.DYNAMIC_DRAW);p.enableVertexAttribArray(1);p.vertexAttribPointer(1,1,p.FLOAT,!1,20,0);p.enableVertexAttribArray(2);p.vertexAttribPointer(2,3,p.FLOAT,!1,20,4);p.enableVertexAttribArray(3);p.vertexAttribPointer(3,1,p.FLOAT,!1,20,16);p.drawArrays(w,0,d.H.length)}}}}a:switch(this.state.a){case "intro":c=
sa`
        ${Ba()}
        <div
            style="
                position: absolute;
                left: 50%;
                display: flex;
                height: 100%;
            "
        >
            <div
                style="
                    margin: auto 0;
                    color: #FFE8C6;
                    font: 15vh Impact;
                "
            >
                BACK<br />COUNTRY
                <hr style="border: solid #D45230 10px;" />
                <button
                    onclick="game.dispatch(${0}, 'map');"
                    style="color: #FFE8C6;"
                >
                    PLAY
                </button>
            </div>
        </div>
    `;break a;case "wanted":c=sa`
        ${Ba()}
        <div
            style="
                position: absolute;
                top: 10%;
                height: 25%;
                width: 100%;
                color: #222;
                text-align: center;
                font: 15vh Impact;
            "
        >
            WANTED
        </div>
        <div
            style="
                position: absolute;
                bottom: 10%;
                height: 25%;
                width: 100%;
                color: #222;
                text-align: center;
                font: 10vh Impact;
            "
        >
            <button onclick="game.dispatch(${0}, 'mine');" style="color: #FFE8C6;">
                ACCEPT BOUNTY
            </button>
        </div>
    `;break a;default:c=Ba()}c!==db&&(this.Ra.innerHTML=db=c);Za(this,performance.now()-b,document.querySelector("#frame"));cb&&(cb.textContent=(1/a).toFixed())}start(){let a=1/60,b=0,c=performance.now(),d=e=>{let f=(e-c)/1E3;for(b+=f;b>a;)b-=a,this.Ha(a);this.Ia(f);c=e;this.ta=requestAnimationFrame(d)};this.stop();this.audio.resume();d(c)}stop(){this.audio.suspend();cancelAnimationFrame(this.ta)}add({b:a,rotation:b,scale:c,c:d=[],children:e=[]}){let f=this.Da();Db(a,b,c)(this)(f);for(let g of d)g(this)(f);
a=this[0][f];for(let g of e)e=this.add(g),e=this[0][e],e.parent=a,a.children.push(e);return f}ha(a){if(1&this.a[a])for(let b of this[0][a].children)this.ha(b.h);this.a[a]=0}};return async function(){ua.j=await Yb("/models.tfu");Ta(ua);ua.start()}(),Ca.Ta=ua,Ca})({});
    window.game = backcountry.game;
</script>
